# SPEC-WEB2MANUAL-003: 인수 기준 (수락 기준)

## 메타데이터

| 항목 | 값 |
|------|-----|
| SPEC ID | SPEC-WEB2MANUAL-003 |
| 기능명 | 라이브 플레이그라운드 (Live Playground) |
| 검증 도구 | Vitest (유닛/통합), Playwright (E2E) |
| 커버리지 목표 | 85% 이상 |

---

## 1. 터미널 에뮬레이터 인수 기준

### AC-PG-001: 터미널 초기 렌더링

**Given** 사용자가 `/playground` 페이지에 접근할 때
**When** 페이지가 완전히 로드되면
**Then** xterm.js 기반 터미널이 화면에 렌더링되어야 한다
**And** 프롬프트(`$ `)가 표시되어야 한다
**And** 터미널에 포커스가 자동으로 설정되어야 한다

### AC-PG-002: 터미널 입력 처리

**Given** 터미널이 활성 상태일 때
**When** 사용자가 키보드로 텍스트를 입력하면
**Then** 입력된 문자가 프롬프트 뒤에 실시간으로 표시되어야 한다
**And** Backspace 키로 문자를 삭제할 수 있어야 한다

### AC-PG-003: 명령어 실행

**Given** 터미널에 명령어가 입력된 상태에서
**When** 사용자가 Enter 키를 누르면
**Then** 입력된 명령어가 처리되어야 한다
**And** 적절한 응답이 터미널에 출력되어야 한다
**And** 새로운 프롬프트가 표시되어야 한다

### AC-PG-004: Ctrl+C 중단

**Given** 타이핑 애니메이션이 진행 중일 때
**When** 사용자가 Ctrl+C를 누르면
**Then** 진행 중인 애니메이션이 즉시 중단되어야 한다
**And** `^C` 표시 후 새 프롬프트가 나타나야 한다

### AC-PG-005: Ctrl+L 클리어

**Given** 터미널에 여러 줄의 출력이 있을 때
**When** 사용자가 Ctrl+L을 누르면
**Then** 터미널 화면이 클리어되어야 한다
**And** 새 프롬프트가 첫 줄에 표시되어야 한다

### AC-PG-006: 터미널 자동 리사이즈

**Given** 플레이그라운드가 활성 상태일 때
**When** 브라우저 창 크기가 변경되면
**Then** 터미널이 컨테이너에 맞게 자동으로 리사이즈되어야 한다
**And** 기존 출력 내용이 유지되어야 한다

### AC-PG-007: 복사/붙여넣기

**Given** 터미널에 출력 텍스트가 있을 때
**When** 사용자가 텍스트를 선택하고 Ctrl+C(또는 Cmd+C)를 누르면
**Then** 선택된 텍스트가 클립보드에 복사되어야 한다
**When** 사용자가 Ctrl+V(또는 Cmd+V)를 누르면
**Then** 클립보드의 텍스트가 프롬프트에 붙여넣기되어야 한다

---

## 2. 명령어 시뮬레이션 인수 기준

### AC-PG-008: claude --version 명령어

**Given** 터미널이 활성 상태일 때
**When** 사용자가 `claude --version`을 입력하고 Enter를 누르면
**Then** Claude Code 버전 정보(예: `claude v1.0.32`)가 출력되어야 한다
**And** 응답 출력에 타이핑 효과가 적용되지 않아야 한다 (즉시 출력)

### AC-PG-009: claude /help 명령어

**Given** 터미널이 활성 상태일 때
**When** 사용자가 `claude /help`를 입력하고 Enter를 누르면
**Then** 사용 가능한 슬래시 명령어 목록이 출력되어야 한다
**And** 각 명령어에 대한 간략한 설명이 포함되어야 한다

### AC-PG-010: AI 응답 시뮬레이션

**Given** `todo-express` 프로젝트가 선택된 상태에서
**When** 사용자가 `claude "describe this project"`를 입력하면
**Then** 해당 프로젝트에 대한 설명이 타이핑 효과와 함께 출력되어야 한다
**And** 타이핑 속도는 문자당 20-50ms여야 한다
**And** 응답 내용은 현재 선택된 프로젝트에 맞는 내용이어야 한다

### AC-PG-011: 다단계 시뮬레이션 (버그 수정)

**Given** `todo-express` 프로젝트가 선택된 상태에서
**When** 사용자가 `claude "fix the bug in app.js"`를 입력하면
**Then** 다음 단계가 순서대로 표시되어야 한다:
  1. "파일 분석 중..." (로딩 인디케이터와 함께)
  2. 식별된 버그 설명
  3. 수정 제안 diff (diff 형식으로 표시)
  4. "수정이 적용되었습니다." 확인 메시지

### AC-PG-012: 미지원 명령어 처리

**Given** 터미널이 활성 상태일 때
**When** 사용자가 지원되지 않는 명령어(예: `npm install express`)를 입력하면
**Then** `"알 수 없는 명령어입니다. 'claude /help'를 입력하여 사용 가능한 명령어를 확인하세요."` 에러 메시지가 출력되어야 한다
**And** 에러 메시지는 빨간색(에러 색상)으로 표시되어야 한다

### AC-PG-013: 명령어 히스토리 탐색

**Given** 사용자가 여러 명령어를 실행한 상태에서
**When** 위쪽 방향키를 누르면
**Then** 이전에 입력한 명령어가 프롬프트에 표시되어야 한다
**When** 아래쪽 방향키를 누르면
**Then** 다음 명령어로 이동하거나 빈 프롬프트가 표시되어야 한다

### AC-PG-014: 쉘 명령어 - ls

**Given** `todo-express` 프로젝트가 선택된 상태에서
**When** 사용자가 `ls`를 입력하면
**Then** 현재 디렉토리의 파일 및 폴더 목록이 표시되어야 한다
**And** 디렉토리는 구분 가능하게 표시되어야 한다 (색상 또는 슬래시)

### AC-PG-015: 타이핑 중 즉시 완료

**Given** AI 응답의 타이핑 효과가 진행 중일 때
**When** 사용자가 Enter를 누르면
**Then** 나머지 응답이 즉시 전체 표시되어야 한다
**And** 새 프롬프트가 나타나야 한다

---

## 3. 샘플 프로젝트 인수 기준

### AC-PG-016: 프로젝트 선택

**Given** 플레이그라운드가 로드된 상태에서
**When** ProjectSelector에서 `todo-express`를 클릭하면
**Then** 좌측 패널에 todo-express의 파일 트리가 표시되어야 한다
**And** 터미널의 프롬프트가 `~/todo-express $`로 변경되어야 한다
**And** 환영 메시지에 프로젝트 설명이 포함되어야 한다

### AC-PG-017: 파일 트리 탐색

**Given** 프로젝트가 선택된 상태에서
**When** 파일 트리에서 폴더 아이콘을 클릭하면
**Then** 해당 폴더가 열리고 하위 파일/폴더가 표시되어야 한다
**When** 다시 클릭하면
**Then** 폴더가 닫혀야 한다

### AC-PG-018: 파일 내용 표시

**Given** 파일 트리가 표시된 상태에서
**When** 사용자가 `app.js` 파일을 클릭하면
**Then** 파일 내용이 구문 강조와 함께 코드 뷰어에 표시되어야 한다
**And** JavaScript 구문에 맞는 색상 강조가 적용되어야 한다
**And** 줄 번호가 표시되어야 한다

### AC-PG-019: 프로젝트 초기화

**Given** 프로젝트에서 여러 명령어를 실행한 상태에서
**When** 사용자가 "프로젝트 초기화" 버튼을 클릭하면
**Then** 프로젝트 파일이 원래 상태로 복원되어야 한다
**And** 터미널 히스토리가 클리어되어야 한다
**And** 환영 메시지가 다시 표시되어야 한다

---

## 4. 세션 관리 인수 기준

### AC-PG-020: 세션 내보내기

**Given** 터미널에 여러 명령어와 응답이 있는 상태에서
**When** 사용자가 "기록 내보내기" 버튼을 클릭하면
**Then** `.txt` 파일이 자동으로 다운로드되어야 한다
**And** 파일에는 모든 입력 명령어와 출력 응답이 시간순으로 포함되어야 한다
**And** 파일명은 `playground-session-{날짜}.txt` 형식이어야 한다

### AC-PG-021: 세션 초기화

**Given** 플레이그라운드에서 작업 중인 상태에서
**When** 사용자가 "세션 초기화" 버튼을 클릭하면
**Then** 확인 대화상자가 표시되어야 한다
**When** 사용자가 확인하면
**Then** 모든 터미널 히스토리가 삭제되어야 한다
**And** 명령어 히스토리가 초기화되어야 한다
**And** 프로젝트가 기본 상태로 복원되어야 한다

---

## 5. UI/UX 인수 기준

### AC-PG-022: 데스크톱 3패널 분할 뷰

**Given** 화면 너비가 768px 이상일 때
**When** 플레이그라운드 페이지가 로드되면
**Then** 좌측에 파일 트리 패널이 표시되어야 한다
**And** 중앙에 터미널 패널이 표시되어야 한다
**And** 우측에 코드 에디터 패널이 표시되어야 한다
**And** 각 패널 사이에 드래그 가능한 분할선이 있어야 한다

### AC-PG-022b: 패널 리사이즈

**Given** 3패널 레이아웃이 표시된 상태에서
**When** 사용자가 분할선을 드래그하면
**Then** 패널 크기가 실시간으로 변경되어야 한다
**And** 패널 최소 크기(파일트리: 150px, 에디터: 200px) 이하로는 줄어들지 않아야 한다

### AC-PG-023: 모바일 스택 레이아웃

**Given** 화면 너비가 768px 미만일 때
**When** 플레이그라운드 페이지가 로드되면
**Then** 파일 트리, 터미널, 에디터가 탭으로 전환 가능한 스택 레이아웃으로 표시되어야 한다
**And** 터미널 탭이 기본으로 선택되어 있어야 한다
**And** 탭을 전환하면 해당 패널이 전체 화면으로 표시되어야 한다

### AC-PG-024: 시뮬레이션 모드 라벨

**Given** 플레이그라운드 페이지가 로드될 때
**When** 페이지가 렌더링되면
**Then** "시뮬레이션 모드"라는 라벨이 페이지 상단에 명확하게 표시되어야 한다
**And** 라벨은 시각적으로 눈에 띄는 색상(예: 노란색 배경)이어야 한다

### AC-PG-025: 환영 메시지

**Given** 플레이그라운드에 처음 진입할 때
**When** 터미널이 초기화되면
**Then** 환영 메시지가 표시되어야 한다
**And** 메시지에는 사용 가능한 기본 명령어 목록이 포함되어야 한다
**And** 메시지에는 "시뮬레이션 환경입니다" 안내가 포함되어야 한다

### AC-PG-021b: 전체화면 토글

**Given** 플레이그라운드가 정상적으로 표시되어 있을 때
**When** 사용자가 전체화면 토글 버튼을 클릭하면
**Then** 플레이그라운드가 전체화면으로 확장되어야 한다
**When** 다시 클릭하면
**Then** 원래 크기로 돌아와야 한다

### AC-PG-021c: localStorage 세션 자동 저장

**Given** 사용자가 플레이그라운드에서 여러 명령어를 실행한 상태에서
**When** 명령어 실행 후 1초가 경과하면
**Then** 세션 상태가 localStorage에 자동 저장되어야 한다
**And** 저장 항목에 명령어 히스토리, 출력 버퍼, 활성 파일, 현재 템플릿 ID가 포함되어야 한다

### AC-PG-021d: 세션 복원

**Given** localStorage에 이전 세션이 저장되어 있는 상태에서
**When** 사용자가 플레이그라운드 페이지를 새로고침하면
**Then** 이전 세션이 자동으로 복원되어야 한다
**And** 명령어 히스토리가 유지되어야 한다
**And** 마지막 활성 파일이 에디터에 표시되어야 한다
**And** 터미널 출력 내역이 복원되어야 한다

### AC-PG-021e: 손상된 세션 데이터 처리

**Given** localStorage에 손상된 세션 데이터가 저장되어 있을 때
**When** 플레이그라운드 페이지가 로드되면
**Then** 손상된 데이터를 감지하고 자동 초기화해야 한다
**And** 사용자에게 오류 없이 정상적인 초기 상태를 표시해야 한다

---

## 6. 성능 인수 기준

### AC-PG-026: 지연 로딩 검증

**Given** 사용자가 메인 페이지(`/`)에 있을 때
**When** 네트워크 요청을 모니터링하면
**Then** xterm.js 관련 JavaScript 청크가 로드되지 않아야 한다
**When** 사용자가 `/playground`로 이동하면
**Then** xterm.js 관련 청크가 동적으로 로드되어야 한다

### AC-PG-027: 초기 로드 시간

**Given** `/playground` 페이지에 처음 접근할 때
**When** 페이지 로드가 완료되면
**Then** 터미널이 사용 가능한 상태까지 3초 이내에 도달해야 한다
**And** 로딩 중에는 스켈레톤 UI가 표시되어야 한다

### AC-PG-028: 명령어 응답 속도

**Given** 터미널이 활성 상태이고 프로젝트가 선택된 상태에서
**When** 사용자가 지원되는 명령어를 입력하면
**Then** 응답(타이핑 효과 시작)까지 100ms 이내여야 한다
**And** 시뮬레이션 지연(사실적 체험을 위한 의도적 지연)은 이 기준에 포함되지 않는다
**And** 쉘 명령어(ls, cat, pwd)는 즉시(50ms 이내) 응답해야 한다

---

## 7. 보안 인수 기준

### AC-PG-029: 샌드박스 격리

**Given** 플레이그라운드가 활성 상태일 때
**When** 어떤 명령어를 실행하더라도
**Then** 사용자의 실제 파일 시스템에 접근해서는 안 된다
**And** 외부 네트워크 요청이 발생해서는 안 된다
**And** 브라우저의 다른 탭이나 사이트에 영향을 주어서는 안 된다

### AC-PG-030: API 호출 차단

**Given** 플레이그라운드 환경에서
**When** Claude 관련 명령어가 실행될 때
**Then** 실제 Claude API(api.anthropic.com)로의 HTTP 요청이 발생하지 않아야 한다
**And** 모든 응답은 로컬 Mock 데이터에서 생성되어야 한다

---

## 8. 시뮬레이션 정확성 인수 기준

### AC-PG-031: 응답 형식 정확성

**Given** 지원되는 Claude Code 명령어가 실행될 때
**When** Mock 응답이 출력되면
**Then** 응답 형식이 실제 Claude Code CLI 출력과 유사해야 한다
**And** ANSI 색상 코드가 적절히 적용되어야 한다 (에러: 빨강, 성공: 초록, 정보: 파랑)

### AC-PG-032: diff 출력 형식

**Given** 버그 수정 시뮬레이션이 실행될 때
**When** diff가 출력되면
**Then** 표준 unified diff 형식으로 표시되어야 한다
**And** 추가된 줄은 초록색(`+`), 삭제된 줄은 빨간색(`-`)으로 표시되어야 한다

### AC-PG-033: Mock 명령어 공식 문서 정확도

**Given** Claude Code 공식 문서(claude.ai/code/docs)에 명시된 명령어 동작 방식과
**When** SPEC-003의 Mock 응답을 비교하면
**Then** 다음 항목이 85% 이상 일치해야 한다:
  - 명령어 형식 (플래그, 인수 구조)
  - 출력 메시지의 전반적 형식
  - 에러 메시지 패턴
**And** Mock 응답 구현 시 PR 리뷰에 "Claude Code 공식 동작 검증됨" 라벨을 요구해야 한다

### AC-PG-034: COOP/COEP 헤더 격리 검증

**Given** COOP/COEP 헤더가 `/playground/:path*`에만 적용된 상태에서
**When** `/reference`, `/learn`, `/` 경로에서 외부 iframe 또는 리소스를 로드하면
**Then** 해당 경로들은 정상적으로 동작해야 한다 (COOP/COEP 영향 없음)
**And** `/playground` 경로에서만 WebContainers API가 활성화되어야 한다
**And** 다른 페이지에서 YouTube, CodePen 등 외부 embed가 차단되지 않아야 한다

---

## 9. Quality Gate (품질 게이트)

### 코드 품질

| 기준 | 목표 | 측정 방법 |
|------|------|-----------|
| TypeScript strict 준수 | 에러 0건 | `tsc --noEmit` |
| ESLint 경고 | 0건 | `eslint --max-warnings 0` |
| 테스트 커버리지 | 85% 이상 | Vitest coverage |
| 번들 크기 (playground 청크) | 500KB 이하 (gzip) | next build 분석 |

### 성능 지표

| 기준 | 목표 | 측정 방법 |
|------|------|-----------|
| 플레이그라운드 초기 로드 | 3초 이내 | Lighthouse / Fast 3G |
| Mock 명령어 응답 시작 | 1초 이내 | 수동 측정 |
| 쉘 명령어 응답 | 100ms 이내 | 수동 측정 |
| 터미널 입력 지연 | 감지 불가 수준 (16ms 이내) | 수동 체감 |

### 브라우저 호환성

| 브라우저 | 터미널 | WebContainers | Monaco Editor |
|----------|--------|---------------|---------------|
| Chrome 90+ | 필수 지원 | 지원 | 지원 |
| Edge 90+ | 필수 지원 | 지원 | 지원 |
| Firefox 90+ | 필수 지원 | 제한적 | 지원 |
| Safari 15+ | 필수 지원 | 제한적 | 지원 |
| 모바일 Chrome | 기본 지원 | 미지원 | 미지원 |
| 모바일 Safari | 기본 지원 | 미지원 | 미지원 |

### 접근성

| 기준 | 목표 |
|------|------|
| ARIA 라벨 | 터미널, 파일 트리, 버튼에 적절한 aria-label 제공 |
| 키보드 탐색 | Tab으로 주요 영역 이동 가능 |
| 색상 대비 | WCAG AA 기준 충족 (4.5:1 이상) |
| 스크린 리더 | 시뮬레이션 모드 안내, 명령어 결과 읽기 지원 |

---

## 10. Definition of Done (완료 정의)

SPEC-WEB2MANUAL-003의 구현이 "완료"로 인정되기 위한 조건:

1. **모든 필수 요구사항 구현**: REQ-PG-TERM, REQ-PG-CMD, REQ-PG-PROJ, REQ-PG-SESS, REQ-PG-SEC, REQ-PG-UX, REQ-PG-PERF의 [Ubiquitous], [Event-Driven], [State-Driven], [Unwanted] 요구사항이 모두 구현됨
2. **모든 필수 인수 기준 통과**: AC-PG-001 ~ AC-PG-032의 Given-When-Then 시나리오가 검증됨
3. **품질 게이트 통과**: TypeScript 에러 0건, ESLint 경고 0건, 테스트 커버리지 85% 이상
4. **성능 기준 충족**: 초기 로드 3초 이내, 명령어 응답 1초 이내
5. **보안 검증 완료**: 샌드박스 격리 확인, 외부 API 호출 없음 확인
6. **브라우저 호환성 확인**: Chrome, Edge, Firefox, Safari에서 터미널 기능 정상 동작
7. **반응형 레이아웃 확인**: 데스크톱 3패널 분할 뷰와 모바일 탭 스택 뷰 정상 동작
8. **세션 영속성 확인**: localStorage 저장/복원 정상 동작, 손상 데이터 자동 초기화
9. **코드 리뷰 완료**: 구현 코드에 대한 리뷰 완료

---

## 11. TRUST 5 검증

| 차원 | 검증 항목 |
|------|-----------|
| **Tested** | 유닛 테스트 85%+ 커버리지, E2E 테스트 주요 시나리오 커버, 명령어 핸들러/파일 시스템/세션 매니저 전체 테스트 |
| **Readable** | 명확한 변수/함수 명명, TypeScript 인터페이스 문서화, 한국어 주석 |
| **Unified** | ESLint + Prettier 포맷팅 일관성, shadcn/ui 컴포넌트 일관된 사용 |
| **Secured** | 사용자 입력 실행 차단, XSS 방지 (xterm.js 내장), CSP 헤더 설정, 외부 네트워크 요청 차단 |
| **Trackable** | Conventional Commits, SPEC-WEB2MANUAL-003 참조, 변경 로그 기록 |
